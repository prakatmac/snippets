#!/usr/bin/ruby

require 'rexml/document'
require 'rexml/xpath'

require 'open-uri'

doc = REXML::Document.new(%Q{
  <div id="list" style="display: block; "><ul><li data="0"><span class="rank">1.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,0#thinker1">Alaa Al Aswany</a></span></li><li data="1"><span class="rank">1.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,1#thinker2">Mohamed ElBaradei</a></span></li><li data="2"><span class="rank">1.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,1#thinker2">Wael Ghonim</a></span></li><li data="3"><span class="rank">1.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,2#thinker3">Ali Ferzat</a></span></li><li data="4"><span class="rank">1.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,2#thinker3">Razan Zaitouneh</a></span></li><li data="5"><span class="rank">1.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,3#thinker4">Rached Ghannouchi</a></span></li><li data="6"><span class="rank">1.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,3#thinker4">Khairat El Shater </a></span></li><li data="7"><span class="rank">1.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,4#thinker5">Tawakkol Karman</a></span></li><li data="8"><span class="rank">1.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,5#thinker6">Wadah Khanfar</a></span></li><li data="9"><span class="rank">1.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,6#thinker7">Eman Al Nafjan</a></span></li><li data="10"><span class="rank">1.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,6#thinker7">Manal al-Sharif</a></span></li><li data="11"><span class="rank">1.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,7#thinker8">Fathi Terbil</a></span></li><li data="12"><span class="rank">1.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,8#thinker9">Srdja Popovic</a></span></li><li data="13"><span class="rank">1.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,8#thinker9">Gene Sharp</a></span></li><li data="14"><span class="rank">10.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,9#thinker10">Ben Bernanke</a></span></li><li data="15"><span class="rank">10.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,9#thinker10">Jean-Claude Trichet</a></span></li><li data="16"><span class="rank">10.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,9#thinker10">Zhou Xiaochuan</a></span></li><li data="17"><span class="rank">11.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,10#thinker11">Barack Obama</a></span></li><li data="18"><span class="rank">12.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,11#thinker12">Dick Cheney</a></span></li><li data="19"><span class="rank">12.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,11#thinker12">Condoleezza Rice</a></span></li><li data="20"><span class="rank">13.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,12#thinker13">Bill and Melinda Gates</a></span></li><li data="21"><span class="rank">14.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,13#thinker14">Azim Premji</a></span></li><li data="22"><span class="rank">15.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,14#thinker15">Christine Lagarde</a></span></li><li data="23"><span class="rank">16.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,15#thinker16">Ahmet Davutoglu</a></span></li><li data="24"><span class="rank">16.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,15#thinker16">Recep Tayyip Erdogan</a></span></li><li data="25"><span class="rank">17.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,16#thinker17">Jack Dorsey</a></span></li><li data="26"><span class="rank">17.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,16#thinker17">Mark Zuckerberg</a></span></li><li data="27"><span class="rank">18.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,17#thinker18">Ai Weiwei</a></span></li><li data="28"><span class="rank">19.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,18#thinker19">He Weifang</a></span></li><li data="29"><span class="rank">19.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,18#thinker19">Yu Keping</a></span></li><li data="30"><span class="rank">20.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,19#thinker20">Hillary and Bill Clinton</a></span></li><li data="31"><span class="rank">21.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,20#thinker21">Nicolas Sarkozy</a></span></li></ul><ul><li data="32"><span class="rank">22.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,21#thinker22">Bernard-Henri Lévy</a></span></li><li data="33"><span class="rank">23.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,22#thinker23">Gene Cretz</a></span></li><li data="34"><span class="rank">23.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,22#thinker23">Elizabeth Dibble</a></span></li><li data="35"><span class="rank">23.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,22#thinker23">Robert Godec</a></span></li><li data="36"><span class="rank">23.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,22#thinker23">Carlos Pascual</a></span></li><li data="37"><span class="rank">23.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,22#thinker23">Anne Patterson</a></span></li><li data="38"><span class="rank">24.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,23#thinker24">Sami Ben Gharbia</a></span></li><li data="39"><span class="rank">24.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,23#thinker24">Daniel Domscheit-Berg</a></span></li><li data="40"><span class="rank">24.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,23#thinker24">Alexey Navalny</a></span></li><li data="41"><span class="rank">25.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,24#thinker25">Carmen Reinhart</a></span></li><li data="42"><span class="rank">25.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,24#thinker25">Kenneth Rogoff</a></span></li><li data="43"><span class="rank">26.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,25#thinker26">David Beers</a></span></li><li data="44"><span class="rank">27.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,25#thinker27">Angela Merkel</a></span></li><li data="45"><span class="rank">27.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,25#thinker27">Wolfgang Schäuble</a></span></li><li data="46"><span class="rank">28.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,26#thinker28">Mahmoud Abbas</a></span></li><li data="47"><span class="rank">28.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,26#thinker28">Salam Fayyad</a></span></li><li data="48"><span class="rank">29.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,26#thinker29">Mizuho Fukushima, Yuichi Kaido</a></span></li><li data="49"><span class="rank">30.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,27#thinker30">Nouriel Roubini</a></span></li><li data="50"><span class="rank">31.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,27#thinker31">Aung San Suu Kyi</a></span></li><li data="51"><span class="rank">32.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,28#thinker32">Paul Krugman</a></span></li><li data="52"><span class="rank">33.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,28#thinker33">Joseph Stiglitz</a></span></li><li data="53"><span class="rank">34.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,29#thinker34">Elizabeth Warren</a></span></li><li data="54"><span class="rank">35.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,29#thinker35">Amy Chua</a></span></li><li data="55"><span class="rank">36.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,30#thinker36">George P. Mitchell</a></span></li><li data="56"><span class="rank">36.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,30#thinker36">Terry Engelder</a></span></li><li data="57"><span class="rank">36.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,30#thinker36">Gary Lash</a></span></li><li data="58"><span class="rank">37.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,30#thinker37">Anna Hazare</a></span></li><li data="59"><span class="rank">38.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,31#thinker38">Mike Mullen</a></span></li><li data="60"><span class="rank">39.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,31#thinker39">David Cameron</a></span></li><li data="61"><span class="rank">40.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,32#thinker40">Paul Ryan</a></span></li><li data="62"><span class="rank">41.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,32#thinker41">Robert Zoellick</a></span></li><li data="63"><span class="rank">42.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,33#thinker42">Dilma Rousseff</a></span></li></ul><ul><li data="64"><span class="rank">43.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,33#thinker43">Edward Glaeser</a></span></li><li data="65"><span class="rank">43.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,33#thinker43">Saskia Sassen</a></span></li><li data="66"><span class="rank">44.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,34#thinker44">Luis Moreno-Ocampo</a></span></li><li data="67"><span class="rank">44.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,34#thinker44">David Scheffer</a></span></li><li data="68"><span class="rank">45.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,34#thinker45">Robert Gates</a></span></li><li data="69"><span class="rank">46.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,35#thinker46">Christina Romer</a></span></li><li data="70"><span class="rank">47.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,35#thinker47">Sherry Rehman</a></span></li><li data="71"><span class="rank">48.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,36#thinker48">Steven Pinker</a></span></li><li data="72"><span class="rank">49.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,36#thinker49">Andrew Sullivan</a></span></li><li data="73"><span class="rank">50.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,37#thinker50">Ron Paul</a></span></li><li data="74"><span class="rank">51.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,37#thinker51">John McCain</a></span></li><li data="75"><span class="rank">52.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,37#thinker52">Francis Deng</a></span></li><li data="76"><span class="rank">52.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,37#thinker52">Gareth Evans</a></span></li><li data="77"><span class="rank">53.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,38#thinker53">Samantha Power</a></span></li><li data="78"><span class="rank">54.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,38#thinker54">Mohamed El-Erian</a></span></li><li data="79"><span class="rank">55.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,38#thinker55">Martin Wolf</a></span></li><li data="80"><span class="rank">56.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,39#thinker56">Paul Collier</a></span></li><li data="81"><span class="rank">57.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,39#thinker57">Ilda Boccassini</a></span></li><li data="82"><span class="rank">58.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,39#thinker58">Thomas Friedman</a></span></li><li data="83"><span class="rank">59.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,40#thinker59">Jens Stoltenberg</a></span></li><li data="84"><span class="rank">60.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,40#thinker60">Esther Duflo</a></span></li><li data="85"><span class="rank">60.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,40#thinker60">Abhijit Banerjee</a></span></li><li data="86"><span class="rank">61.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,40#thinker61">Mikko Hypponen</a></span></li><li data="87"><span class="rank">62.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,41#thinker62">Herman Chinery-Hesse</a></span></li><li data="88"><span class="rank">63.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,41#thinker63">Meir Dagan</a></span></li><li data="89"><span class="rank">64.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,41#thinker64">Joseph Nye</a></span></li><li data="90"><span class="rank">65.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,41#thinker65">Nancy Birdsall</a></span></li><li data="91"><span class="rank">66.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,42#thinker66">Barry Eichengreen</a></span></li><li data="92"><span class="rank">67.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,42#thinker67">Robert D. Kaplan</a></span></li><li data="93"><span class="rank">68.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,42#thinker68">Bruce Bueno de Mesquita</a></span></li><li data="94"><span class="rank">69.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,43#thinker69">Kenneth Roth</a></span></li><li data="95"><span class="rank">70.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,43#thinker70">Zaha Hadid</a></span></li></ul><ul><li data="96"><span class="rank">71.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,43#thinker71">Daniel Kahneman</a></span></li><li data="97"><span class="rank">72.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,44#thinker72">Tyler Cowen</a></span></li><li data="98"><span class="rank">73.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,44#thinker73">Joi Ito</a></span></li><li data="99"><span class="rank">73.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,44#thinker73">Ethan Zuckerman</a></span></li><li data="100"><span class="rank">74.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,44#thinker74">Rory Stewart</a></span></li><li data="101"><span class="rank">75.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,45#thinker75">Maria Bashir</a></span></li><li data="102"><span class="rank">76.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,45#thinker76">Bjorn Lomborg</a></span></li><li data="103"><span class="rank">77.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,45#thinker77">Cem 	Özdemir</a></span></li><li data="104"><span class="rank">78.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,46#thinker78">Lester Brown</a></span></li><li data="105"><span class="rank">79.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,46#thinker79">Deepa Narayan</a></span></li><li data="106"><span class="rank">80.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,46#thinker80">Desmond Tutu</a></span></li><li data="107"><span class="rank">81.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,47#thinker81">Yoani Sánchez</a></span></li><li data="108"><span class="rank">82.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,47#thinker82">Clay Shirky</a></span></li><li data="109"><span class="rank">83.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,47#thinker83">Jared Cohen</a></span></li><li data="110"><span class="rank">83.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,47#thinker83">Alec Ross</a></span></li><li data="111"><span class="rank">84.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,47#thinker84">Mustafa Barghouti</a></span></li><li data="112"><span class="rank">85.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,48#thinker85">Pervez Hoodbhoy</a></span></li><li data="113"><span class="rank">86.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,48#thinker86">Andy Sumner</a></span></li><li data="114"><span class="rank">87.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,48#thinker87">Johanna Sigurdardottir</a></span></li><li data="115"><span class="rank">88.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,48#thinker88">John Githongo</a></span></li><li data="116"><span class="rank">89.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,49#thinker89">Paul Farmer</a></span></li><li data="117"><span class="rank">90.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,49#thinker90">Anne-Marie Slaughter</a></span></li><li data="118"><span class="rank">91.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,49#thinker91">Kishore Mahbubani</a></span></li><li data="119"><span class="rank">92.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,49#thinker92">Ngozi Okonjo-Iweala</a></span></li><li data="120"><span class="rank">93.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,50#thinker93">Lant Pritchett</a></span></li><li data="121"><span class="rank">94.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,50#thinker94">Arundhati Roy</a></span></li><li data="122"><span class="rank">95.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,50#thinker95">Boris Johnson</a></span></li><li data="123"><span class="rank">96.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,50#thinker96">Mari Kuraishi</a></span></li><li data="124"><span class="rank">97.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,51#thinker97">Arvind Subramanian</a></span></li><li data="125"><span class="rank">98.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,51#thinker98">Rick Falkvinge</a></span></li><li data="126"><span class="rank">99.</span><span class="fullName"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,51#thinker99">Teodoro Petkoff</a></span></li><li data="127"><span class="rank" style="width: 25px;">100.</span><span class="fullName" style="width: 115px;"><a href="http://www.foreignpolicy.com/articles/2011/11/28/the_fp_top_100_global_thinkers?page=0,51#thinker127">Stéphane Hessel</a></span></li></ul></div>
})

# Extract Name and URL Information
thinkers = []
doc.elements.each("//span/a") do |e|
  record = {:name => e.text, :url => e.attributes["href"].sub(/\#.+$/, '')}
  thinkers << record
  # puts record[:name]
end

# Extract the Rank Information
ranks = []
doc.elements.each("//span") do |e|
  ranks << e.text.to_i unless e.text.nil?
end

# Kludge the Ranks into our Hash structure
ranks.each_with_index do |rank,index|
  thinkers[index][:rank] = rank
end

# Setup our barebones html
html = []
html << %Q{
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
  "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <title>The FP Top 100 Global Thinkers - Full Annotated List</title>
</head>
<body>
  <div style="width:650px">
}

index = 0; last_url = ""
thinkers.each do |thinker|
  if(thinker[:url] == last_url)
    index = index+1
  else
    index = 0
  end
  raw_html = open(thinker[:url]) {|f| f.read}
  last_url = thinker[:url]

  banner_file_url = nil; picture_file_url = nil
  banner_files = raw_html.scan(/111118\_banner[^\"]*\.jpg/)
  if(index+1 > banner_files.length)
    next
  end
  banner_file = banner_files[index]  
  banner_file_url = "http://www.foreignpolicy.com/files/fp_uploaded_images/#{banner_file}' alt='#{thinker[:name]}"
  picture_file = raw_html.scan(/111118[\d\_]*Thinker[^\"]*\.jpg/).first
  if(!picture_file.nil? && !picture_file.empty?)
    picture_file_url = "http://www.foreignpolicy.com/files/fp_uploaded_images/#{picture_file}"
  end  
  
  if(index == 0 && (!picture_file.nil?) && (!picture_file.empty?))
    html << "<img src='#{picture_file_url}' alt='' width='625' />"
  end
  html << "<img src='#{banner_file_url}' alt='#{thinker[:name]}' />"
end

html << %Q{
  </div>
</body>
</html>
}

puts html.join("\n")